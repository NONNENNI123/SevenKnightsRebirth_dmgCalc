<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>세븐나이츠 리버스 데미지 계산기</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- 상단 고정바 -->
  <header class="topbar">
    <div class="topbar__inner">
      <div class="topbar__left">
        <div class="field">
          <label for="skill_coef">스킬 계수</label>
          <input id="skill_coef" data-k="skill_coef" type="number" step="0.001" inputmode="decimal" />
        </div>

        <div class="field">
          <label for="armor_ignore">방무(0~1)</label>
          <input id="armor_ignore" data-k="armor_ignore" type="number" step="0.001" inputmode="decimal" />
        </div>

        <div class="checks">
          <label class="check"><input data-k="crit_on" type="checkbox" /> 치명</label>
          <label class="check"><input data-k="weak_on" type="checkbox" /> 약점</label>
          <label class="check"><input data-k="block_on" type="checkbox" /> 막기</label>
        </div>
      </div>

      <div class="topbar__right">
        <div class="resultBox">
          <div class="resultBox__label">최종 데미지</div>
          <div id="result_dmg" class="resultBox__value">-</div>
          <div id="result_hint" class="resultBox__hint">-</div>
        </div>

        <div class="topbar__actions">
          <button id="btn_reset" class="btn btn--ghost" type="button">초기화</button>
          <button id="btn_export" class="btn" type="button">내보내기(JSON)</button>
          <button id="btn_import" class="btn btn--ghost" type="button">가져오기</button>
          <input id="import_file" type="file" accept="application/json" hidden />
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- 본문 2열: 공격자/피격자 -->
    <section class="grid2">
      <!-- 공격자 -->
      <article class="card">
        <div class="card__head">
          <div>
            <h2 class="card__title">때리는놈</h2>
            <p class="card__sub">공격자 스탯/버프/기타</p>
          </div>

          <div class="card__controls">
            <label class="check check--pill">
              <input data-k="atk_use_equip" type="checkbox" />
              장비 관리
            </label>

            <div class="field field--small">
              <label>덱</label>
              <select data-k="atk_deck">
                <option value="default">기본</option>
                <option value="deck1">덱1</option>
                <option value="deck2">덱2</option>
              </select>
            </div>
          </div>
        </div>

        <div class="tabs" data-tabs="atk">
          <div class="tabs__bar">
            <button class="tab is-active" data-tab="base" type="button">기본</button>
            <button class="tab" data-tab="buff" type="button">버프</button>
            <button class="tab" data-tab="etc" type="button">기타</button>
          </div>

          <div class="tabs__panel is-active" data-panel="base">
            <div class="formGrid">
              <div class="field">
                <label>기본 공격력</label>
                <input data-k="atk_base" type="number" step="1" inputmode="numeric" />
              </div>
              <div class="field">
                <label>추가 공격력</label>
                <input data-k="atk_add" type="number" step="1" inputmode="numeric" />
              </div>
              <div class="field">
                <label>치명타 데미지(배율)</label>
                <input data-k="crit_dmg_stat" type="number" step="0.001" inputmode="decimal" />
                <div class="hint">예: 1.5 = 150%</div>
              </div>
              <div class="field">
                <label>약점공격 데미지(배율)</label>
                <input data-k="weak_dmg_stat" type="number" step="0.001" inputmode="decimal" />
                <div class="hint">예: 1.3 = 130%</div>
              </div>
              <div class="field">
                <label>복수자 보너스(주는피해)</label>
                <input data-k="dmg_inc_revenge" type="number" step="0.001" inputmode="decimal" />
              </div>
            </div>
          </div>

          <div class="tabs__panel" data-panel="buff">
            <div class="sectionTitle">공격자 버프(상시/턴제)</div>
            <div class="formGrid">
              <div class="field">
                <label>공증(상시)</label>
                <input data-k="atk_buff_always" type="number" step="0.001" inputmode="decimal" />
              </div>
              <div class="field">
                <label>공증(턴제)</label>
                <input data-k="atk_buff_turn" type="number" step="0.001" inputmode="decimal" />
              </div>
              <div class="field">
                <label>주는피해증(상시)</label>
                <input data-k="dmg_inc_always" type="number" step="0.001" inputmode="decimal" />
              </div>
              <div class="field">
                <label>주는피해증(턴제)</label>
                <input data-k="dmg_inc_turn" type="number" step="0.001" inputmode="decimal" />
              </div>

              <div class="field">
                <label>치뎀증(상시)</label>
                <input data-k="crit_dmg_always" type="number" step="0.001" inputmode="decimal" />
              </div>
              <div class="field">
                <label>치뎀증(턴제)</label>
                <input data-k="crit_dmg_turn" type="number" step="0.001" inputmode="decimal" />
              </div>

              <div class="field">
                <label>약뎀증(상시)</label>
                <input data-k="weak_dmg_always" type="number" step="0.001" inputmode="decimal" />
              </div>
              <div class="field">
                <label>약뎀증(턴제)</label>
                <input data-k="weak_dmg_turn" type="number" step="0.001" inputmode="decimal" />
              </div>
            </div>

            <details class="details">
              <summary>상대에게 거는 디버프(공감/피감 등)</summary>
              <div class="formGrid">
                <div class="field">
                  <label>공감(상시)</label>
                  <input data-k="atk_debuff_always" type="number" step="0.001" inputmode="decimal" />
                </div>
                <div class="field">
                  <label>공감(턴제)</label>
                  <input data-k="atk_debuff_turn" type="number" step="0.001" inputmode="decimal" />
                </div>
                <div class="field">
                  <label>주는피감(상시)</label>
                  <input data-k="dmg_dec_always" type="number" step="0.001" inputmode="decimal" />
                </div>
                <div class="field">
                  <label>주는피감(턴제)</label>
                  <input data-k="dmg_dec_turn" type="number" step="0.001" inputmode="decimal" />
                </div>
              </div>
            </details>
          </div>

          <div class="tabs__panel" data-panel="etc">
            <div class="sectionTitle">초월/진형/펫/기타</div>
            <div class="formGrid">
              <div class="field">
                <label>초월 공증</label>
                <input data-k="atk_transcend_bonus" type="number" step="0.001" inputmode="decimal" />
              </div>
              <div class="field">
                <label>진형 보너스(공)</label>
                <input data-k="atk_form_bonus" type="number" step="0.001" inputmode="decimal" />
              </div>
              <div class="field">
                <label>펫 성장(공격력)</label>
                <input data-k="atk_pet" type="number" step="1" inputmode="numeric" />
              </div>
              <div class="field">
                <label>펫 스킬 공증</label>
                <input data-k="atk_buff_pet" type="number" step="0.001" inputmode="decimal" />
              </div>
            </div>
          </div>
        </div>
      </article>

      <!-- 피격자 -->
      <article class="card">
        <div class="card__head">
          <div>
            <h2 class="card__title">맞는놈</h2>
            <p class="card__sub">피격자 스탯/버프/기타</p>
          </div>

          <div class="card__controls">
            <label class="check check--pill">
              <input data-k="def_use_equip" type="checkbox" />
              장비 관리
            </label>

            <div class="field field--small">
              <label>덱</label>
              <select data-k="def_deck">
                <option value="default">기본</option>
                <option value="deck1">덱1</option>
                <option value="deck2">덱2</option>
              </select>
            </div>
          </div>
        </div>

        <div class="tabs" data-tabs="def">
          <div class="tabs__bar">
            <button class="tab is-active" data-tab="base" type="button">기본</button>
            <button class="tab" data-tab="buff" type="button">버프</button>
            <button class="tab" data-tab="etc" type="button">기타</button>
          </div>

          <div class="tabs__panel is-active" data-panel="base">
            <div class="formGrid">
              <div class="field">
                <label>기본 방어력</label>
                <input data-k="def_base" type="number" step="1" inputmode="numeric" />
              </div>
              <div class="field">
                <label>추가 방어력</label>
                <input data-k="def_add" type="number" step="1" inputmode="numeric" />
              </div>
              <div class="field">
                <label>받피감(스탯)</label>
                <input data-k="taken_dec_stat" type="number" step="0.001" inputmode="decimal" />
                <div class="hint">예: 0.2 = 20% 감소</div>
              </div>
              <div class="field">
                <label>막기 데미지 감소(스탯)</label>
                <input data-k="block_dec_stat" type="number" step="0.001" inputmode="decimal" />
              </div>
            </div>
          </div>

          <div class="tabs__panel" data-panel="buff">
            <div class="sectionTitle">피격자 버프/디버프(받피증/받피감/방증/방깎)</div>
            <div class="formGrid">
              <div class="field">
                <label>방증(상시)</label>
                <input data-k="def_buff_always" type="number" step="0.001" inputmode="decimal" />
              </div>
              <div class="field">
                <label>방증(턴제)</label>
                <input data-k="def_buff_turn" type="number" step="0.001" inputmode="decimal" />
              </div>

              <div class="field">
                <label>받피감(상시)</label>
                <input data-k="taken_dec_always" type="number" step="0.001" inputmode="decimal" />
              </div>
              <div class="field">
                <label>받피감(턴제)</label>
                <input data-k="taken_dec_turn" type="number" step="0.001" inputmode="decimal" />
              </div>

              <div class="field">
                <label>받피증(상시)</label>
                <input data-k="taken_inc_always" type="number" step="0.001" inputmode="decimal" />
              </div>
              <div class="field">
                <label>받피증(턴제)</label>
                <input data-k="taken_inc_turn" type="number" step="0.001" inputmode="decimal" />
              </div>
            </div>

            <details class="details">
              <summary>피격자에게 걸린 방깎(상시/턴제)</summary>
              <div class="formGrid">
                <div class="field">
                  <label>방깎(상시)</label>
                  <input data-k="def_debuff_always" type="number" step="0.001" inputmode="decimal" />
                </div>
                <div class="field">
                  <label>방깎(턴제)</label>
                  <input data-k="def_debuff_turn" type="number" step="0.001" inputmode="decimal" />
                </div>
              </div>
            </details>
          </div>

          <div class="tabs__panel" data-panel="etc">
            <div class="sectionTitle">초월/진형/펫/기타</div>
            <div class="formGrid">
              <div class="field">
                <label>초월 방증</label>
                <input data-k="def_transcend_bonus" type="number" step="0.001" inputmode="decimal" />
              </div>
              <div class="field">
                <label>진형 보너스(방)</label>
                <input data-k="def_form_bonus" type="number" step="0.001" inputmode="decimal" />
              </div>
              <div class="field">
                <label>펫 성장(방어력)</label>
                <input data-k="def_pet" type="number" step="1" inputmode="numeric" />
              </div>
              <div class="field">
                <label>펫 스킬 방증</label>
                <input data-k="def_buff_pet" type="number" step="0.001" inputmode="decimal" />
              </div>

              <label class="check check--pill">
                <input data-k="is_jave" type="checkbox" />
                제이브(예외)
              </label>
            </div>
          </div>
        </div>
      </article>
    </section>

    <!-- 장비 섹션 -->
    <section class="card">
      <div class="card__head">
        <div>
          <h2 class="card__title">세부 장비</h2>
          <p class="card__sub">장비 관리 ON일 때 입력하는 영역 (엑셀의 무기/방어구 옵션)</p>
        </div>
        <div class="pill" id="equip_state">장비 관리: OFF</div>
      </div>

      <div class="equipGrid" id="equip_wrap">
        <!-- 무기1 -->
        <div class="equipCard">
          <div class="equipCard__title">무기 1</div>
          <div class="formGrid formGrid--dense">
            <div class="field">
              <label>깡공</label>
              <input data-k="w1_flat_atk" type="number" step="1" inputmode="numeric" />
            </div>
            <div class="field">
              <label>메인 옵션</label>
              <select data-k="w1_main_opt">
                <option value="">-</option>
                <option value="atk_pct">공격력%</option>
                <option value="atk_flat">깡공격력</option>
                <option value="crit_dmg">치명타 데미지</option>
                <option value="weak_dmg">약점공격 데미지</option>
              </select>
            </div>
            <div class="field">
              <label>메인 수치</label>
              <input data-k="w1_main_val" type="number" step="0.001" inputmode="decimal" />
            </div>

            <div class="field">
              <label>서브1</label>
              <select data-k="w1_s1_opt">
                <option value="">-</option>
                <option value="atk_pct">공격력%</option>
                <option value="atk_flat">깡공격력</option>
                <option value="crit_dmg">치명타 데미지</option>
                <option value="weak_dmg">약점공격 데미지</option>
              </select>
            </div>
            <div class="field">
              <label>수치</label>
              <input data-k="w1_s1_val" type="number" step="0.001" inputmode="decimal" />
            </div>

            <div class="field">
              <label>서브2</label>
              <select data-k="w1_s2_opt">
                <option value="">-</option>
                <option value="atk_pct">공격력%</option>
                <option value="atk_flat">깡공격력</option>
                <option value="crit_dmg">치명타 데미지</option>
                <option value="weak_dmg">약점공격 데미지</option>
              </select>
            </div>
            <div class="field">
              <label>수치</label>
              <input data-k="w1_s2_val" type="number" step="0.001" inputmode="decimal" />
            </div>

            <div class="field">
              <label>서브3</label>
              <select data-k="w1_s3_opt">
                <option value="">-</option>
                <option value="atk_pct">공격력%</option>
                <option value="atk_flat">깡공격력</option>
                <option value="crit_dmg">치명타 데미지</option>
                <option value="weak_dmg">약점공격 데미지</option>
              </select>
            </div>
            <div class="field">
              <label>수치</label>
              <input data-k="w1_s3_val" type="number" step="0.001" inputmode="decimal" />
            </div>
          </div>
        </div>

        <!-- 무기2 -->
        <div class="equipCard">
          <div class="equipCard__title">무기 2</div>
          <div class="formGrid formGrid--dense">
            <div class="field">
              <label>깡공</label>
              <input data-k="w2_flat_atk" type="number" step="1" inputmode="numeric" />
            </div>
            <div class="field">
              <label>메인 옵션</label>
              <select data-k="w2_main_opt">
                <option value="">-</option>
                <option value="atk_pct">공격력%</option>
                <option value="atk_flat">깡공격력</option>
                <option value="crit_dmg">치명타 데미지</option>
                <option value="weak_dmg">약점공격 데미지</option>
              </select>
            </div>
            <div class="field">
              <label>메인 수치</label>
              <input data-k="w2_main_val" type="number" step="0.001" inputmode="decimal" />
            </div>

            <div class="field"><label>서브1</label><select data-k="w2_s1_opt">
              <option value="">-</option><option value="atk_pct">공격력%</option><option value="atk_flat">깡공격력</option><option value="crit_dmg">치명타 데미지</option><option value="weak_dmg">약점공격 데미지</option>
            </select></div>
            <div class="field"><label>수치</label><input data-k="w2_s1_val" type="number" step="0.001" inputmode="decimal" /></div>

            <div class="field"><label>서브2</label><select data-k="w2_s2_opt">
              <option value="">-</option><option value="atk_pct">공격력%</option><option value="atk_flat">깡공격력</option><option value="crit_dmg">치명타 데미지</option><option value="weak_dmg">약점공격 데미지</option>
            </select></div>
            <div class="field"><label>수치</label><input data-k="w2_s2_val" type="number" step="0.001" inputmode="decimal" /></div>

            <div class="field"><label>서브3</label><select data-k="w2_s3_opt">
              <option value="">-</option><option value="atk_pct">공격력%</option><option value="atk_flat">깡공격력</option><option value="crit_dmg">치명타 데미지</option><option value="weak_dmg">약점공격 데미지</option>
            </select></div>
            <div class="field"><label>수치</label><input data-k="w2_s3_val" type="number" step="0.001" inputmode="decimal" /></div>
          </div>
        </div>

        <!-- 방어구1 -->
        <div class="equipCard">
          <div class="equipCard__title">방어구 1</div>
          <div class="formGrid formGrid--dense">
            <div class="field">
              <label>깡방</label>
              <input data-k="a1_flat_def" type="number" step="1" inputmode="numeric" />
            </div>
            <div class="field">
              <label>메인 옵션</label>
              <select data-k="a1_main_opt">
                <option value="">-</option>
                <option value="def_pct">방어력%</option>
                <option value="def_flat">깡방어력</option>
                <option value="taken_dec">받는 피해 감소</option>
                <option value="block_dec">막기 데미지 감소</option>
              </select>
            </div>
            <div class="field">
              <label>메인 수치</label>
              <input data-k="a1_main_val" type="number" step="0.001" inputmode="decimal" />
            </div>

            <div class="field"><label>서브1</label><select data-k="a1_s1_opt">
              <option value="">-</option><option value="def_pct">방어력%</option><option value="def_flat">깡방어력</option><option value="taken_dec">받는 피해 감소</option><option value="block_dec">막기 데미지 감소</option>
            </select></div>
            <div class="field"><label>수치</label><input data-k="a1_s1_val" type="number" step="0.001" inputmode="decimal" /></div>

            <div class="field"><label>서브2</label><select data-k="a1_s2_opt">
              <option value="">-</option><option value="def_pct">방어력%</option><option value="def_flat">깡방어력</option><option value="taken_dec">받는 피해 감소</option><option value="block_dec">막기 데미지 감소</option>
            </select></div>
            <div class="field"><label>수치</label><input data-k="a1_s2_val" type="number" step="0.001" inputmode="decimal" /></div>

            <div class="field"><label>서브3</label><select data-k="a1_s3_opt">
              <option value="">-</option><option value="def_pct">방어력%</option><option value="def_flat">깡방어력</option><option value="taken_dec">받는 피해 감소</option><option value="block_dec">막기 데미지 감소</option>
            </select></div>
            <div class="field"><label>수치</label><input data-k="a1_s3_val" type="number" step="0.001" inputmode="decimal" /></div>
          </div>
        </div>

        <!-- 방어구2 -->
        <div class="equipCard">
          <div class="equipCard__title">방어구 2</div>
          <div class="formGrid formGrid--dense">
            <div class="field">
              <label>깡방</label>
              <input data-k="a2_flat_def" type="number" step="1" inputmode="numeric" />
            </div>
            <div class="field">
              <label>메인 옵션</label>
              <select data-k="a2_main_opt">
                <option value="">-</option>
                <option value="def_pct">방어력%</option>
                <option value="def_flat">깡방어력</option>
                <option value="taken_dec">받는 피해 감소</option>
                <option value="block_dec">막기 데미지 감소</option>
              </select>
            </div>
            <div class="field">
              <label>메인 수치</label>
              <input data-k="a2_main_val" type="number" step="0.001" inputmode="decimal" />
            </div>

            <div class="field"><label>서브1</label><select data-k="a2_s1_opt">
              <option value="">-</option><option value="def_pct">방어력%</option><option value="def_flat">깡방어력</option><option value="taken_dec">받는 피해 감소</option><option value="block_dec">막기 데미지 감소</option>
            </select></div>
            <div class="field"><label>수치</label><input data-k="a2_s1_val" type="number" step="0.001" inputmode="decimal" /></div>

            <div class="field"><label>서브2</label><select data-k="a2_s2_opt">
              <option value="">-</option><option value="def_pct">방어력%</option><option value="def_flat">깡방어력</option><option value="taken_dec">받는 피해 감소</option><option value="block_dec">막기 데미지 감소</option>
            </select></div>
            <div class="field"><label>수치</label><input data-k="a2_s2_val" type="number" step="0.001" inputmode="decimal" /></div>

            <div class="field"><label>서브3</label><select data-k="a2_s3_opt">
              <option value="">-</option><option value="def_pct">방어력%</option><option value="def_flat">깡방어력</option><option value="taken_dec">받는 피해 감소</option><option value="block_dec">막기 데미지 감소</option>
            </select></div>
            <div class="field"><label>수치</label><input data-k="a2_s3_val" type="number" step="0.001" inputmode="decimal" /></div>
          </div>
        </div>
      </div>
    </section>

    <!-- 디버그 -->
    <section class="card">
      <details class="details" open>
        <summary>디버그(중간값) — 엑셀 값 맞추기용</summary>
        <div class="debugGrid">
          <div class="debugItem"><div class="k">atkEff</div><div class="v" id="dbg_atkEff">-</div></div>
          <div class="debugItem"><div class="k">defEff</div><div class="v" id="dbg_defEff">-</div></div>
          <div class="debugItem"><div class="k">defFactor</div><div class="v" id="dbg_defFactor">-</div></div>
          <div class="debugItem"><div class="k">giveInc</div><div class="v" id="dbg_giveInc">-</div></div>
          <div class="debugItem"><div class="k">giveDec</div><div class="v" id="dbg_giveDec">-</div></div>
          <div class="debugItem"><div class="k">takeInc</div><div class="v" id="dbg_takeInc">-</div></div>
          <div class="debugItem"><div class="k">takeDec</div><div class="v" id="dbg_takeDec">-</div></div>
          <div class="debugItem"><div class="k">critMul</div><div class="v" id="dbg_critMul">-</div></div>
          <div class="debugItem"><div class="k">weakMul</div><div class="v" id="dbg_weakMul">-</div></div>
          <div class="debugItem"><div class="k">blockMul</div><div class="v" id="dbg_blockMul">-</div></div>
        </div>
      </details>
    </section>

    <footer class="footer">
      <div class="muted">정적 페이지(GitHub Pages)용 · 계산식은 formulas.js에서 교체</div>
    </footer>
  </main>

  <script type="module" src="ui.js"></script>
</body>
</html>
